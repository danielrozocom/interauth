FROM node:18-bullseye

# Use a non-root user if desired (optional)
WORKDIR /app

# NOTE: This Dockerfile is intended for local development only.
# It runs the Vite dev server (`pnpm dev`) and should NOT be used
# as the production image. Production builds should use the
# top-level `Dockerfile` which runs the built app with `npm start`.

# Ensure NIXPACKS_PATH points to local bin directory so it's defined inside the image
ENV NIXPACKS_PATH=/app/node_modules/.bin:$PATH

# Enable corepack and prepare pnpm v8.15.9 (avoids using `npm install -g`)
RUN corepack enable && corepack prepare pnpm@8.15.9 --activate

# Copy only lockfiles first for better caching
COPY package.json pnpm-lock.yaml ./

# Install dependencies (will be stored in image node_modules)
# Use --no-frozen-lockfile so build won't fail when a lockfile is missing
# pnpm will still use the lockfile if it exists.
RUN pnpm install --no-frozen-lockfile

EXPOSE 5173

# Default command runs vite in host mode so it's reachable from host
CMD ["pnpm", "dev", "--", "--host", "0.0.0.0"]
